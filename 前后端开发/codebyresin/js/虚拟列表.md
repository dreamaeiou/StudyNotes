```js
import React, { useState, useEffect, useRef, CSSProperties } from 'react';

const getTestData = (length: number): string[] => {
let dataList: string[] = [];
for (let i = 0; i < length; i++) {
dataList = [...dataList, `测试数据${Math.ceil(Math.random() * 10)}`];
}
return dataList;
};

const redundancy = 4; // 冗余量 渲染节点数 = 一页能渲染多少个节点 + 冗余量

// 获取虚拟列表展示的数据
const getRenderList: <T>(
list: T[],
renderLength: number,
start?: number
) => T[] = (list, renderLength, start) => {
start = start || 0;
return list.slice(start, start + renderLength);
};

function VirtualScrollList() {
const [dataList, setDataList] = useState<string[]>([]); // 所有的数据
const [renderList, setRenderList] = useState<string[]>([]); // 需要渲染的数据
const [offSetY, setOffSetY] = useState<number>(0); // 向下的偏移量
const [activeIndex, setActiveIndex] = useState<number>(-1); // 激活的项

// 不会触发渲染的变量推荐用 useRef 进行维护
const renderLength = useRef<number>(0); // 一页能渲染多少个节点
const rowNodeHeight = useRef<number>(0); // 一个节点有多高
const totalHeight = useRef<number>(0); // 总高度
const containerRef = useRef<HTMLDivElement>(null);

// 获取虚拟列表渲染多少个
const getRenderLength = (): number => {
const containerNode = containerRef.current;
const rowNode: HTMLDivElement | null = document.querySelector(
'.virtual_scroll_row'
);
if (containerNode && rowNode) {
rowNodeHeight.current = rowNode.clientHeight;
return (
Math.ceil(containerNode.clientHeight / rowNodeHeight.current) +
redundancy
); // 一页能渲染多少个节点 + 冗余量
}
return 0;
};

// todo: 列表滚动中
const handleTableScroll = (e: React.UIEvent<HTMLDivElement>): void => {
const scrollTop = (e.target as HTMLDivElement).scrollTop; // 已经滚动了多少 px
const offsetItemNumber = Math.floor(scrollTop / rowNodeHeight.current);

    // 计算起始索引
    const startIndex = Math.max(
      0,
      offsetItemNumber - Math.floor(redundancy / 2)
    );

    // 更新偏移量
    setOffSetY(startIndex * rowNodeHeight.current);

    // 更新渲染列表
    setRenderList(getRenderList(dataList, renderLength.current, startIndex));

};

useEffect(() => {
const data = getTestData(100);
setDataList(data);
}, []);

useEffect(() => {
setRenderList(dataList.slice(0, 1)); // 先渲染一个
}, [dataList]);

useEffect(() => {
// 渲染一行后获取一页能渲染多少个以及单个的高度
if (renderList.length === 1 && renderList.length !== dataList.length) {
renderLength.current = getRenderLength(); // 获取一次渲染多少个 row
setRenderList(getRenderList(dataList, renderLength.current)); // 获取渲染数据

      // 计算总高度
      totalHeight.current = dataList.length * rowNodeHeight.current;
    }

}, [renderList, dataList]);

const containerStyle: CSSProperties = {
width: '100%',
height: '600px',
overflow: 'auto',
border: '2px solid #e0e0e0',
borderRadius: '12px',
backgroundColor: '#f8fafc',
boxShadow: '0 4px 20px rgba(0, 0, 0, 0.08)',
position: 'relative',
fontFamily:
'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
};

const contentStyle: CSSProperties = {
height: `${totalHeight.current}px`,
position: 'relative'
};

const scrollContentStyle: CSSProperties = {
position: 'absolute',
top: 0,
left: 0,
width: '100%',
transform: `translateY(${offSetY}px)`
};

const rowStyle = (index: number): CSSProperties => ({
height: '60px',
display: 'flex',
alignItems: 'center',
padding: '0 24px',
borderBottom: '1px solid #e9ecef',
backgroundColor: activeIndex === index ? '#f0f9ff' : 'white',
transition: 'all 0.2s ease',
cursor: 'pointer',
fontSize: '16px',
color: activeIndex === index ? '#2563eb' : '#374151',
boxSizing: 'border-box',
position: 'relative'
});

const indexStyle: CSSProperties = {
width: '40px',
height: '28px',
backgroundColor: '#e2e8f0',
color: '#475569',
borderRadius: '6px',
display: 'flex',
alignItems: 'center',
justifyContent: 'center',
fontSize: '14px',
fontWeight: '600',
marginRight: '16px'
};

const headerStyle: CSSProperties = {
padding: '20px 24px',
borderBottom: '2px solid #e5e7eb',
backgroundColor: 'white',
borderTopLeftRadius: '10px',
borderTopRightRadius: '10px'
};

const titleStyle: CSSProperties = {
margin: 0,
fontSize: '20px',
fontWeight: '700',
color: '#1f2937'
};

const subtitleStyle: CSSProperties = {
margin: '8px 0 0',
fontSize: '14px',
color: '#6b7280',
fontWeight: '400'
};

const statsStyle: CSSProperties = {
padding: '16px 24px',
backgroundColor: 'white',
borderBottom: '1px solid #e5e7eb',
display: 'flex',
gap: '24px',
alignItems: 'center'
};

const statItemStyle: CSSProperties = {
display: 'flex',
flexDirection: 'column',
alignItems: 'center'
};

const statValueStyle: CSSProperties = {
fontSize: '18px',
fontWeight: '700',
color: '#2563eb'
};

const statLabelStyle: CSSProperties = {
fontSize: '12px',
color: '#6b7280',
marginTop: '4px'
};

const getCurrentStats = () => {
const startIndex = Math.floor(offSetY / rowNodeHeight.current);
const visibleCount = renderLength.current - redundancy;
return {
startIndex,
endIndex: startIndex + visibleCount - 1,
visibleCount,
renderedCount: renderList.length,
total: dataList.length
};
};

const stats = getCurrentStats();

return (
<div style={{ padding: '24px', maxWidth: '800px', margin: '0 auto' }}>
<div style={statsStyle}>
<div style={statItemStyle}>
<span style={statValueStyle}>{stats.visibleCount}</span>
<span style={statLabelStyle}>可见项数</span>
</div>
<div style={statItemStyle}>
<span style={statValueStyle}>{stats.renderedCount}</span>
<span style={statLabelStyle}>实际渲染</span>
</div>
<div style={statItemStyle}>
<span style={statValueStyle}>{redundancy}</span>
<span style={statLabelStyle}>冗余量</span>
</div>
<div style={statItemStyle}>
<span style={statValueStyle}>{stats.startIndex + 1}</span>
<span style={statLabelStyle}>开始索引</span>
</div>
<div style={statItemStyle}>
<span style={statValueStyle}>{stats.endIndex + 1}</span>
<span style={statLabelStyle}>结束索引</span>
</div>
<div style={statItemStyle}>
<span style={statValueStyle}>{stats.total}</span>
<span style={statLabelStyle}>总数据量</span>
</div>
</div>

      <div
        ref={containerRef}
        className="virtual_scroll_container"
        style={containerStyle}
        onScroll={handleTableScroll}
      >
        <div style={contentStyle}>
          <div className="virtual_scroll" style={scrollContentStyle}>
            {renderList.map((item: string, index) => {
              const actualIndex = stats.startIndex + index;
              return (
                <div
                  className="virtual_scroll_row"
                  key={`virtual_scroll_row_${actualIndex}`}
                  style={rowStyle(actualIndex)}
                  onClick={() =>
                    setActiveIndex(
                      actualIndex === activeIndex ? -1 : actualIndex
                    )
                  }
                  title={`点击选中，索引: ${actualIndex}`}
                >
                  <div style={indexStyle}>{actualIndex + 1}</div>
                  <div style={{ flex: 1 }}>{item}</div>
                  {actualIndex === activeIndex && (
                    <div
                      style={{
                        position: 'absolute',
                        right: '16px',
                        width: '8px',
                        height: '8px',
                        backgroundColor: '#3b82f6',
                        borderRadius: '50%',
                        animation: 'pulse 1.5s infinite'
                      }}
                    />
                  )}
                </div>
              );
            })}
          </div>
        </div>
      </div>

      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.5; transform: scale(1.2); }
        }

        .virtual_scroll_row:hover {
          background-color: #f1f5f9 !important;
          transform: translateX(4px);
        }

        .virtual_scroll_row:active {
          transform: translateX(2px) scale(0.995);
        }

        ::-webkit-scrollbar {
          width: 10px;
          height: 10px;
        }

        ::-webkit-scrollbar-track {
          background: #f1f5f9;
          border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
      `}</style>
    </div>

);
}

export default VirtualScrollList;
```
